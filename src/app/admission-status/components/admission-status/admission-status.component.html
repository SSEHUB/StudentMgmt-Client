<div class="tab" *ngIf="criteria$ | async as criteria">
	<h2 class="title">
		<span>{{ "Title.AdmissionStatus" | translate }}</span>
		<span>
			<button mat-stroked-button (click)="downloadCsv()">Export</button>
		</span>
	</h2>

	<div class="admission-criteria">
		<h3>{{ "Domain.AdmissionCriteria" | translate }}</h3>

		<div class="rules" *ngIf="criteria; else noAdmissionCriteria">
			<ng-container *ngFor="let rule of criteria.rules; let i = index">
				<app-admission-rule [rule]="rule" [index]="i"></app-admission-rule>
			</ng-container>
		</div>

		<ng-template #noAdmissionCriteria>
			{{ "Common.None" | translate }}
		</ng-template>
	</div>

	<div class="participants">
		<h3>{{ "Domain.Participants" | translate }}</h3>

		<mat-form-field class="full-width">
			<mat-label>Filter</mat-label>
			<input matInput #filter [(ngModel)]="dataSource.filter" />
		</mat-form-field>

		<table class="full-width" mat-table matSort [dataSource]="dataSource">
			<ng-container matColumnDef="displayName">
				<th class="name-column" mat-header-cell mat-sort-header *matHeaderCellDef>Name</th>
				<td mat-cell *matCellDef="let row">
					<a
						class="font-bold link-none"
						[routerLink]="['/courses', courseId, 'users', row.participant.userId]"
					>
						{{ row.participant.displayName }}
					</a>
				</td>
			</ng-container>

			<ng-container matColumnDef="matrNr">
				<th mat-header-cell *matHeaderCellDef>MatrNr</th>
				<td mat-cell *matCellDef="let row">
					<a
						class="font-bold link-none"
						[routerLink]="['/courses', courseId, 'users', row.participant.userId]"
					>
						{{ row.participant.matrNr || "??????" }}
					</a>
				</td>
			</ng-container>

			<ng-container matColumnDef="hasAdmissionCombined">
				<th mat-header-cell mat-sort-header *matHeaderCellDef>
					{{ "Domain.Admission" | translate }}
				</th>
				<td mat-cell *matCellDef="let row">
					<app-thumb-chip [condition]="row.hasAdmissionCombined"></app-thumb-chip>
				</td>
			</ng-container>

			<ng-container matColumnDef="hasAdmission">
				<th mat-header-cell mat-sort-header *matHeaderCellDef>Kriterien erf√ºllt</th>
				<td mat-cell *matCellDef="let row">
					<app-thumb-chip [condition]="row.hasAdmission"></app-thumb-chip>
				</td>
			</ng-container>

			<ng-container matColumnDef="hasAdmissionFromPreviousSemester">
				<th mat-header-cell mat-sort-header *matHeaderCellDef>Altzulassung</th>
				<td mat-cell *matCellDef="let row">
					<app-thumb-chip
						[condition]="row.hasAdmissionFromPreviousSemester"
					></app-thumb-chip>
				</td>
			</ng-container>

			<ng-container *ngFor="let rule of criteria?.rules; let i = index">
				<ng-container [matColumnDef]="'rule' + i">
					<th class="rule-column" mat-header-cell *matHeaderCellDef>
						<div class="rule-info">
							<span>{{ "Common.Criteria" | translate }} #{{ i }}</span>
						</div>
					</th>
					<td class="result" mat-cell *matCellDef="let row">
						<div class="font-bold">
							<span
								*ngIf="row.results[i].passed; else no"
								class="text-green text-bold"
								>{{ "Common.Yes" | translate }}</span
							>
							<ng-template #no>
								<span class="text-red">{{ "Common.No" | translate }}</span>
							</ng-template>
							({{ row.results[i].achievedPoints }} -
							{{
								row.results[i].achievedPercent !== undefined &&
								row.results[i].achievedPercent !== null
									? (row.results[i].achievedPercent | number: "1.0-2")
									: "NaN"
							}}%)
						</div>
					</td>
				</ng-container>
			</ng-container>

			<tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
			<tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
		</table>
	</div>
</div>
